<!-- macro library for navigation -->
<!-- $Id$ -->

<!-- ============================================================ -->
<!-- this require a batch_info from BaseNavigation.getTree -->
<metal:block define-macro="batch_info"
  tal:condition="python:batch_info and batch_info['nb_pages'] > 1">
<div align="right" class="even">
  <span i18n:translate="">
    Objects: <tal:block replace="batch_info/start"
    i18n:name="batch_start" /> - <tal:block replace="batch_info/stop"
    i18n:name="batch_limit" /> of <tal:block replace="batch_info/length"
    i18n:name="batch_length" />
  </span>
</div>
</metal:block>


<!-- ============================================================ -->
<!-- this require a batch_info from BaseNavigation.getTree -->
<metal:block define-macro="batch_nav"
  tal:condition="python:batch_info and batch_info['nb_pages'] > 1">
<table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr class="even">
    <td align="center" width="100%">
      <span i18:translate="label_page">Pages</span>:
      <a tal:define="previous batch_info/previous"
        tal:condition="python:previous is not None"
        tal:attributes="href python:'%s?%s'%(request['URL'],
          mq(request.form, b_start=previous))"
        i18n:translate="batch_previous">Previous</a>
      <a tal:repeat="page batch_info/pages"
        tal:attributes="href python:'%s?%s'%(request['URL'],
          mq(request.form, b_start=page))"
        tal:omit-tag="python:page == batch_info['start'] - 1"
        tal:content="repeat/page/number">1</a>
      <a tal:define="next batch_info/next"
        tal:condition="python:next is not None"
        tal:attributes="href python:'%s?%s'%(request['URL'],
          mq(request.form, b_start=next))"
        i18n:translate="batch_next">Next</a>
    </td>
  </tr>
</table>
</metal:block>

<!-- ============================================================ -->
<!-- folder -->
<metal:block define-macro="render_node_folder">
  <tal:block replace="structure node/object/short_title" />
</metal:block>

<metal:block define-macro="render_listing_header_multi_select_folder">
  <input name="uids:list" type="checkbox" class="noborder"
    tal:attributes="value listing_info/current_uid">
  <tal:block replace="listing_info/current/title_or_id|nothing" />
</metal:block>

<metal:block define-macro="render_listing_header_folder">
  <input name="uid" type="radio" class="noborder" checked="checked"
    tal:attributes="value listing_info/current_uid">
  <tal:block replace="listing_info/current/title_or_id|nothing" />
</metal:block>

<metal:block define-macro="render_listing_item_multi_select_folder"
  tal:define="doc item/getContent;
  item_desc doc/description;
  item_uid python: utool.getRelativeUrl(item);">
  <input name="uids:list" type="checkbox" class="noborder"
        tal:attributes="value item_uid">
  <img tal:replace="structure python:here.getImgTag(item.getIcon(),
    base_url=base_url)">&nbsp;
  <a href="" tal:attributes="title item_desc;
    href python:'%s?%s'%(request.URL0,
    mq(request.form, current_uid=item_uid));">
    <tal:block replace="item/title_or_id" />
  </a>
</metal:block>

<metal:block define-macro="render_listing_item_folder"
  tal:define="doc item/getContent;
  item_desc doc/description;
  item_uid python: utool.getRelativeUrl(item);">
  <input name="uid" type="radio" class="noborder"
        tal:attributes="value item_uid;
                        id item_desc;">
  <img tal:replace="structure python:here.getImgTag(item.getIcon(),
    base_url=base_url)">&nbsp;
  <a href="" tal:attributes="title item_desc;
    href python:'%s?%s'%(request.URL0,
    mq(request.form, current_uid=item_uid));">
    <tal:block replace="item/title_or_id" />
  </a>
</metal:block>

<metal:block define-macro="render_selection_folder">
  <img tal:replace="structure item/img_tag">&nbsp;
  <tal:block replace="item/title_or_id" />
</metal:block>


<!-- ============================================================ -->
<!-- ldap -->
<metal:block define-macro="render_node_ldap">
  <tal:block replace="python:
here.truncate(node['object'].get(display_attr, ['%s not found!'% display_attr])[0])" />
</metal:block>

<metal:block define-macro="render_listing_header_ldap"
  tal:define="item_desc python: listing_info['current'].get(display_attr, ['%s
not found' % display_attr])[0];
              item_uid listing_info/current_uid" >
  <input name="uid" type="radio" class="noborder" checked="checked"
    tal:attributes="value item_uid; id item_desc">
  <tal:block replace="item_desc" />
</metal:block>

<metal:block define-macro="render_listing_header_multi_select_ldap">
  <input name="uids:list" type="checkbox" class="noborder"
        tal:attributes="value listing_info/current_uid">
  <tal:block replace="python: listing_info['current'].get(display_attr, ['%s
not found' % display_attr])[0]" />
</metal:block>


<metal:block define-macro="render_listing_item_multi_select_ldap"
  tal:define="item_uid python: item['dn'];">
  <input name="uids:list" type="checkbox" class="noborder"
        tal:attributes="value item_uid">
  <a href="" tal:attributes="title item_uid;
    href python:'%s?%s'%(request.URL0,
    mq(request.form, current_uid=item_uid));">
    <tal:block replace="python: item.get(display_attr,['%s not found!' % display_attr])[0]" />
  </a>
</metal:block>

<metal:block define-macro="render_listing_item_ldap"
  tal:define="item_uid python: item['dn'];
              item_desc python: item.get(display_attr,['%s not found!' % display_attr])[0];">
  <input name="uid" type="radio" class="noborder"
    tal:attributes="value item_uid;id item_desc;">
  <a href="" tal:attributes="title item_uid;
    href python:'%s?%s'%(request.URL0,
    mq(request.form, current_uid=item_uid));">
    <tal:block replace="item_desc" />
  </a>
</metal:block>


<metal:block define-macro="render_selection_ldap">
  <tal:block replace="item/title" />
</metal:block>



<!-- ============================================================ -->
<!-- this is a nav/detail/multi selection table you should define -->
<!-- expected res (a getNavigation result) root_uid and type -->
<metal:block define-macro="multi_select_navigation"
  tal:define="root_uid root_uid|request/root_uid;
              input_id request/input_id|nothing;
              title request/title|nothing;
              display_attr request/display_attr|nothing;
              vocabulary request/vocabulary|nothing;
              tree python:res[0];
              listing python:res[1];
              batch_info python:res[2];
              listing_info python:res[3];
              mq nocall:modules/ZTUtils/make_query;
              current_uid request/current_uid|nothing;
              selection python:here.manageSelection(REQUEST=request,
              type=type);
">
<h1 tal:content="title" />
<form action="" method="post">
<br><center>
<table bgcolor="#333333" width="95%" cellspacing="0" cellpadding="0"><tr><td>
<table width="100%" cellspacing="1" cellpadding="5">
<tr><th width="33%" class="even" i18n:translate="">label_navigation</th>
  <th width="33%" class="even" i18n:translate="">label_detail</th>
  <th width="33%" class="even" i18n:translate="">label_selection</th>
</tr>
<tr><td width="33%" valign="top" class="odd">
<div class="box" style="white-space: nowrap;">
<tal:block repeat="node tree">
  <tal:block repeat="line node/lines"
    content="structure python:3*'&nbsp;' + test(not line, '&nbsp;', test(line==1, '|', '`'))" />
  <tal:block
    content="python:test(node['state'] == 'open', '>',
                         test(node['state'] == 'closed', '+', '-'))" />

  <a tal:attributes="
    class python:test(node['is_current'], 'selected', nothing);
    href python:'%s?%s'%(request['URL0'],
     mq(request.form, current_uid=node['uid']));">
  <metal:block use-macro="python:path('here/navigation_lib/macros/render_node_%s'%type)" />
  </a><br>
</tal:block>
</div>
</td><td valign="top" width="33%" class="odd">
  <div tal:condition="listing_info/current">
  <a accesskey="U" tal:condition="listing_info/parent_uid"
    tal:attributes="href python:'%s?%s'%(request['URL0'],
    mq(request.form, current_uid=listing_info['parent_uid']));">
  <img tal:replace="structure python:here.getImgTag('UpFolder_icon.gif',
  base_url=base_url)"> ..<br></a>
  <h4 tal:condition="not:listing_info/hide_current">
    <metal:block use-macro="python:path('here/navigation_lib/macros/render_listing_header_multi_select_%s'%type)" />
  </h4>
  <metal:block use-macro="here/navigation_lib/macros/batch_info" />

  <tal:block repeat="item listing">
    <div>
      &nbsp;&nbsp;<metal:block use-macro="python:path('here/navigation_lib/macros/render_listing_item_multi_select_%s'%type)" />
    </div>
  </tal:block>
  <metal:block use-macro="here/navigation_lib/macros/batch_nav" />
  <br>
  <input type="submit" class="context"
    name="add_items_to_selection"
    value="button_select" i18n:attributes="value">
  </div>

</td><td valign="top" with="33%" class="odd">
  <div tal:condition="selection">
  <tal:block repeat="item selection">
    <div>
      <input name="selected_uids:list" type="checkbox" class="noborder"
        tal:attributes="value item/uid">
        <metal:block use-macro="python:path('here/navigation_lib/macros/render_selection_%s'%type)" />
    </div>
  </tal:block>
  <br>
  <input type="submit" class="context" value="button_delete"
    name="del_items_from_selection"
    i18n:attributes="value">
  <metal:block define-slot="action">
  <input type="submit" class="standalone" value="button_update"
    i18n:attributes="value">
  </metal:block>
  </div>

</td></tr></table>
</td></tr></table>
</center>
  <input type="hidden" name="root_uid" tal:attributes="value root_uid">
  <input type="hidden" name="current_uid" tal:attributes="value current_uid">
  <input type="hidden" name="type" tal:attributes="value type">
  <input type="hidden" name="input_id" tal:attributes="value input_id">
  <input type="hidden" name="title" tal:attributes="value title">
  <input type="hidden" name="display_attr" tal:attributes="value
    display_attr">
  <input type="hidden" name="vocabulary" tal:attributes="value vocabulary">
</form>
</metal:block>


<!-- ============================================================ -->
<!-- this is a nav/detail table you should define -->
<!-- expected res (a getNavigation result) root_uid and type -->
<metal:block define-macro="select_navigation"
  tal:define="root_uid root_uid|request/root_uid;
              input_id request/input_id|nothing;
              title request/title|nothing;
              display_attr request/display_attr|nothing;
              vocabulary request/vocabulary|nothing;
              tree python:res[0];
              listing python:res[1];
              batch_info python:res[2];
              listing_info python:res[3];
              mq nocall:modules/ZTUtils/make_query;
              current_uid request/current_uid|nothing;
">
<h1 tal:content="title" />
<form action="" method="post">
<br><center>
<table bgcolor="#333333" width="95%" cellspacing="0" cellpadding="0"><tr><td>
<table width="100%" cellspacing="1" cellpadding="5">
<tr><th width="40%" class="even" i18n:translate="">label_navigation</th>
  <th width="60%" class="even" i18n:translate="">label_selection</th>
</tr>
<tr><td width="40%" valign="top" class="odd">
<div class="box" style="white-space: nowrap;">
<tal:block repeat="node tree">
  <tal:block repeat="line node/lines"
    content="structure python:3*'&nbsp;' + test(not line, '&nbsp;', test(line==1, '|', '`'))" />
  <tal:block
    content="python:test(node['state'] == 'open', '>',
                         test(node['state'] == 'closed', '+', '-'))" />

  <a tal:attributes="
    class python:test(node['is_current'], 'selected', nothing);
    href python:'%s?%s'%(request['URL0'],
     mq(request.form, current_uid=node['uid']));">
  <metal:block use-macro="python:path('here/navigation_lib/macros/render_node_%s'%type)" />
  </a><br>
</tal:block>
</div>
</td><td valign="top" width="60%" class="odd">
  <div tal:condition="listing_info/current">
  <a accesskey="U" tal:condition="listing_info/parent_uid"
    tal:attributes="href python:'%s?%s'%(request['URL0'],
    mq(request.form, current_uid=listing_info['parent_uid']));">
  <img tal:replace="structure python:here.getImgTag('UpFolder_icon.gif',
  base_url=base_url)"> ..<br></a>
  <h4 tal:condition="not:listing_info/hide_current">
    <metal:block use-macro="python:path('here/navigation_lib/macros/render_listing_header_%s'%type)" />
  </h4>
  <metal:block use-macro="here/navigation_lib/macros/batch_info" />

  <tal:block repeat="item listing">
    <div>
      &nbsp;&nbsp;<metal:block use-macro="python:path('here/navigation_lib/macros/render_listing_item_%s'%type)" />
    </div>
  </tal:block>
  <metal:block use-macro="here/navigation_lib/macros/batch_nav" />
  <br>

  <metal:block define-slot="action">
  <input type="submit" class="standalone" value="button_update"
    i18n:attributes="value">
  </metal:block>

  </div>
</td></tr></table>
</td></tr></table>
</center>
  <input type="hidden" name="root_uid" tal:attributes="value root_uid">
  <input type="hidden" name="current_uid" tal:attributes="value current_uid">
  <input type="hidden" name="type" tal:attributes="value type">
  <input type="hidden" name="input_id" tal:attributes="value input_id">
  <input type="hidden" name="title" tal:attributes="value title">
  <input type="hidden" name="display_attr" tal:attributes="value
    display_attr">
  <input type="hidden" name="vocabulary" tal:attributes="value vocabulary">
</form>
</metal:block>
