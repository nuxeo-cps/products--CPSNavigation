<!-- macro library for navigation -->
<!-- $Id$ -->

<!-- ============================================================ -->
<!-- this require a batch_info from BaseNavigation.getTree -->
<metal:block define-macro="batch_info"
  tal:condition="python:batch_info and batch_info['nb_pages'] > 1">
<div align="right" class="even">
  <span i18n:translate="">
    Objects: <tal:block replace="batch_info/start"
    i18n:name="batch_start" /> - <tal:block replace="batch_info/stop"
    i18n:name="batch_limit" /> of <tal:block replace="batch_info/length"
    i18n:name="batch_length" />
  </span>
</div>
</metal:block>


<!-- ============================================================ -->
<!-- this require a batch_info from BaseNavigation.getTree -->
<metal:block define-macro="batch_nav"
  tal:condition="python:batch_info and batch_info['nb_pages'] > 1">
<table width="100%" border="0" cellspacing="0" cellpadding="0">
  <tr class="even">
    <td align="center" width="100%">
      <span i18:translate="label_page">Pages</span>:
      <a tal:define="previous batch_info/previous"
        tal:condition="python:previous is not None"
        tal:attributes="href python:'%s?%s'%(request['URL'],
          mq(request.form, b_start=previous))"
        i18n:translate="batch_previous">Previous</a>
      <a tal:repeat="page batch_info/pages"
        tal:attributes="href python:'%s?%s'%(request['URL'],
          mq(request.form, b_start=page))"
        tal:omit-tag="python:page == batch_info['start'] - 1"
        tal:content="repeat/page/number">1</a>
      <a tal:define="next batch_info/next"
        tal:condition="python:next is not None"
        tal:attributes="href python:'%s?%s'%(request['URL'],
          mq(request.form, b_start=next))"
        i18n:translate="batch_next">Next</a>
    </td>
  </tr>
</table>
</metal:block>

<!-- ============================================================ -->
<!-- this is a nav/detail/selection table you should define
  a root_uid which is a cps tree name like workspaces or sections -->
<metal:block define-macro="cps_navigation"
  tal:define="title request/title|nothing;
              input_id request/input_id|nothing;
              root_uid root_uid|nothing;
              res python:here.getNavigation(finder='cps',
                                            root_uid=root_uid,REQUEST=request);
              tree python:res[0];
              listing python:res[1];
              batch_info python:res[2];
              listing_info python:res[3];
              mq nocall:modules/ZTUtils/make_query;
              current_uid request/current_uid|nothing;
              selection python:here.manageSelection(REQUEST=request,
              type='folder');
">
<h1 tal:content="title" />
<form action="" method="post">
<br><center>
<table bgcolor="#333333" width="95%" cellspacing="0" cellpadding="0"><tr><td>
<table width="100%" cellspacing="1" cellpadding="5">
<tr><th width="33%" class="even" i18n:translate="">label_folder_navigation</th>
  <th width="33%" class="even" i18n:translate="">label_detail</th>
  <th width="33%" class="even" i18n:translate="">label_selection</th>
</tr>
<tr><td width="33%" valign="top" class="odd">
<div class="box" style="white-space: nowrap;">
<tal:block repeat="node tree">
  <tal:block repeat="line node/lines"
    content="structure python:3*'&nbsp;' + test(not line, '&nbsp;', test(line==1, '|', '`'))" />
  <tal:block
    content="python:test(node['state'] == 'open', '>',
                         test(node['state'] == 'closed', '+', '-'))" />
  <a tal:attributes="
    class python:test(node['is_current'], 'selected', nothing);
    href python:'%s?%s'%(request['URL0'],
     mq(current_uid=node['object']['rpath'], input_id=input_id, title=title));"
    tal:content="node/object/title_or_id" /><br>
</tal:block>
</div>
</td><td valign="top" width="33%" class="odd">
  <a accesskey="U" tal:condition="listing_info/parent_uid"
    tal:attributes="href python:'%s?%s'%(request['URL0'],
    mq(current_uid=listing_info['parent_uid'], input_id=input_id, title=title));">
    <img tal:replace="structure python:here.getImgTag('UpFolder_icon.gif',
  base_url=base_url)"> ..<br></a>

  <div tal:condition="listing_info/current">
  <h4><input name="uids:list" type="checkbox" class="noborder"
        tal:attributes="value listing_info/current_uid">
  <tal:block content="listing_info/current/title_or_id|nothing" /></h4>
  <metal:block use-macro="here/navigation_lib/macros/batch_info" />

  <tal:block repeat="item listing">
    <div tal:define="doc item/getContent;
      item_desc doc/description;
      item_uid python: utool.getRelativeUrl(item);">
      &nbsp;&nbsp;<input name="uids:list" type="checkbox" class="noborder"
        tal:attributes="value item_uid">
      <img tal:replace="structure python:here.getImgTag(item.getIcon(),
        base_url=base_url)">&nbsp;
      <a href="" tal:attributes="title item_desc;
        href python:'%s?%s'%(request.URL0,
          mq(current_uid=item_uid, input_id=input_id, title=title));">
        <tal:block replace="item/title_or_id" />
      </a>
    </div>
  </tal:block>
  <metal:block use-macro="here/navigation_lib/macros/batch_nav" />
  <br>
  <input type="submit" class="context"
    name="add_items_to_selection"
    value="button_select" i18n:attributes="value">
  </div>

</td><td valign="top" with="33%" class="odd">
  <div tal:condition="selection">
  <tal:block repeat="item selection">
    <div>
      <input name="selected_uids:list" type="checkbox" class="noborder"
        tal:attributes="value item/uid">
      <img tal:replace="structure item/img_tag">&nbsp;
      <tal:block replace="item/title_or_id" />
    </div>
  </tal:block>
  <br>
  <input type="hidden" name="type" value="folder">
  <input type="hidden" name="current_uid"
    tal:attributes="value current_uid">
  <input type="hidden" name="input_id"
    tal:attributes="value input_id">
  <input type="hidden" name="title"
    tal:attributes="value title">
  <input type="submit" class="context" value="button_delete"
    name="del_items_from_selection"
    i18n:attributes="value">
  <metal:block define-slot="action">
  <input type="submit" class="standalone" value="button_update"
    i18n:attributes="value">
  </metal:block>
  </div>

</td></tr></table>
</td></tr></table>
</center>
</form>
</metal:block>
